#include "table.h"

#define TABLE_SIZE 62      // 数组大小
#define MIN_ANGLE -3.14f   // 最小角度
#define MAX_ANGLE 3.06f    // 最大角度（由于步长限制）
#define STEP_SIZE 0.1f     // 步长
// 角度范围：-3.14 到 3.14，步长 0.1
// 数组索引 i 对应角度 (-3.14 + i * 0.1)

// sin值查表数组
const float sin_table[] = {
    -0.001593f, // sin(-3.14)
    -0.041581f, // sin(-3.04) 
    -0.141120f, // sin(-2.94)
    -0.239249f, // sin(-2.84)
    -0.334988f, // sin(-2.74)
    -0.427380f, // sin(-2.64)
    -0.515501f, // sin(-2.54)
    -0.598472f, // sin(-2.44)
    -0.675463f, // sin(-2.34)
    -0.745705f, // sin(-2.24)
    -0.808496f, // sin(-2.14)
    -0.863209f, // sin(-2.04)
    -0.909297f, // sin(-1.94)
    -0.946300f, // sin(-1.84)
    -0.973848f, // sin(-1.74)
    -0.991665f, // sin(-1.64)
    -0.999574f, // sin(-1.54)
    -0.997495f, // sin(-1.44)
    -0.985450f, // sin(-1.34)
    -0.963558f, // sin(-1.24)
    -0.932039f, // sin(-1.14)
    -0.891207f, // sin(-1.04)
    -0.841471f, // sin(-0.94)
    -0.783327f, // sin(-0.84)
    -0.717356f, // sin(-0.74)
    -0.644218f, // sin(-0.64)
    -0.564642f, // sin(-0.54)
    -0.479426f, // sin(-0.44)
    -0.389418f, // sin(-0.34)
    -0.295520f, // sin(-0.24)
    -0.198669f, // sin(-0.14)
    -0.099833f, // sin(-0.04)
    0.000000f,  // sin(0.06) ≈ 0.06
    0.099833f,  // sin(0.16) ≈ 0.16
    0.198669f,  // sin(0.26) ≈ 0.26
    0.295520f,  // sin(0.36) ≈ 0.35
    0.389418f,  // sin(0.46) ≈ 0.44
    0.479426f,  // sin(0.56) ≈ 0.53
    0.564642f,  // sin(0.66) ≈ 0.61
    0.644218f,  // sin(0.76) ≈ 0.69
    0.717356f,  // sin(0.86) ≈ 0.76
    0.783327f,  // sin(0.96) ≈ 0.82
    0.841471f,  // sin(1.06) ≈ 0.87
    0.891207f,  // sin(1.16) ≈ 0.92
    0.932039f,  // sin(1.26) ≈ 0.95
    0.963558f,  // sin(1.36) ≈ 0.98
    0.985450f,  // sin(1.46) ≈ 0.997
    0.997495f,  // sin(1.56) ≈ 1.0
    0.999574f,  // sin(1.66) ≈ 0.995
    0.991665f,  // sin(1.76) ≈ 0.98
    0.973848f,  // sin(1.86) ≈ 0.95
    0.946300f,  // sin(1.96) ≈ 0.92
    0.909297f,  // sin(2.06) ≈ 0.87
    0.863209f,  // sin(2.16) ≈ 0.81
    0.808496f,  // sin(2.26) ≈ 0.74
    0.745705f,  // sin(2.36) ≈ 0.67
    0.675463f,  // sin(2.46) ≈ 0.59
    0.598472f,  // sin(2.56) ≈ 0.51
    0.515501f,  // sin(2.66) ≈ 0.42
    0.427380f,  // sin(2.76) ≈ 0.33
    0.334988f,  // sin(2.86) ≈ 0.24
    0.239249f,  // sin(2.96) ≈ 0.15
    0.141120f,  // sin(3.06) ≈ 0.05
};

// cos值查表数组  
const float cos_table[] = {
    -0.999999f, // cos(-3.14)
    -0.999135f, // cos(-3.04)
    -0.989992f, // cos(-2.94)
    -0.970958f, // cos(-2.84)
    -0.942222f, // cos(-2.74)
    -0.904072f, // cos(-2.64)
    -0.856889f, // cos(-2.54)
    -0.801144f, // cos(-2.44)
    -0.737394f, // cos(-2.34)
    -0.666276f, // cos(-2.24)
    -0.588501f, // cos(-2.14)
    -0.504846f, // cos(-2.04)
    -0.416147f, // cos(-1.94)
    -0.323289f, // cos(-1.84)
    -0.227202f, // cos(-1.74)
    -0.128844f, // cos(-1.64)
    -0.029200f, // cos(-1.54)
    0.070737f,  // cos(-1.44)
    0.169967f,  // cos(-1.34)
    0.267499f,  // cos(-1.24)
    0.362358f,  // cos(-1.14)
    0.453596f,  // cos(-1.04)
    0.540302f,  // cos(-0.94)
    0.621610f,  // cos(-0.84)
    0.696707f,  // cos(-0.74)
    0.764842f,  // cos(-0.64)
    0.825336f,  // cos(-0.54)
    0.877583f,  // cos(-0.44)
    0.921061f,  // cos(-0.34)
    0.955337f,  // cos(-0.24)
    0.980067f,  // cos(-0.14)
    0.995004f,  // cos(-0.04)
    0.998200f,  // cos(0.06) ≈ 1.0
    0.987688f,  // cos(0.16) ≈ 0.99
    0.968148f,  // cos(0.26) ≈ 0.97
    0.955337f,  // cos(0.36) ≈ 0.94
    0.921061f,  // cos(0.46) ≈ 0.90
    0.877583f,  // cos(0.56) ≈ 0.85
    0.825336f,  // cos(0.66) ≈ 0.79
    0.764842f,  // cos(0.76) ≈ 0.72
    0.696707f,  // cos(0.86) ≈ 0.65
    0.621610f,  // cos(0.96) ≈ 0.57
    0.540302f,  // cos(1.06) ≈ 0.48
    0.453596f,  // cos(1.16) ≈ 0.39
    0.362358f,  // cos(1.26) ≈ 0.30
    0.267499f,  // cos(1.36) ≈ 0.21
    0.169967f,  // cos(1.46) ≈ 0.11
    0.070737f,  // cos(1.56) ≈ 0.01
    -0.029200f, // cos(1.66) ≈ -0.09
    -0.128844f, // cos(1.76) ≈ -0.18
    -0.227202f, // cos(1.86) ≈ -0.28
    -0.323289f, // cos(1.96) ≈ -0.37
    -0.416147f, // cos(2.06) ≈ -0.46
    -0.504846f, // cos(2.16) ≈ -0.54
    -0.588501f, // cos(2.26) ≈ -0.62
    -0.666276f, // cos(2.36) ≈ -0.69
    -0.737394f, // cos(2.46) ≈ -0.75
    -0.801144f, // cos(2.56) ≈ -0.81
    -0.856889f, // cos(2.66) ≈ -0.87
    -0.904072f, // cos(2.76) ≈ -0.92
    -0.942222f, // cos(2.86) ≈ -0.96
    -0.970958f, // cos(2.96) ≈ -0.99
    -0.989992f, // cos(3.06) ≈ -1.0
};



// 查表函数
float lookup_sin(float angle)
{
    // 处理超出范围的角度
    if (angle < MIN_ANGLE) angle = MIN_ANGLE;
    if (angle > MAX_ANGLE) {
        // 特殊处理3.14
        if (angle >= 3.14f) return -0.001593f;  // sin(3.14) ≈ 0
        angle = MAX_ANGLE;
    }
    
    int index = (int)((angle - MIN_ANGLE) / STEP_SIZE + 0.5f);
    if (index >= TABLE_SIZE) index = TABLE_SIZE - 1;
    if (index < 0) index = 0;
    
    return sin_table[index];
}

float lookup_cos(float angle)
{
    // 处理超出范围的角度
    if (angle < MIN_ANGLE) angle = MIN_ANGLE;
    if (angle > MAX_ANGLE) {
        // 特殊处理3.14
        if (angle >= 3.14f) return -0.999999f;  // cos(3.14) ≈ -1
        angle = MAX_ANGLE;
    }
    
    int index = (int)((angle - MIN_ANGLE) / STEP_SIZE + 0.5f);
    if (index >= TABLE_SIZE) index = TABLE_SIZE - 1;
    if (index < 0) index = 0;
    
    return cos_table[index];
}

// 处理任意角度的函数（利用周期性）
float lookup_sin_any(float angle)
{
    // 将角度规范化到[-π, π]范围
    while (angle > 3.14159f) angle -= 6.28318f;
    while (angle < -3.14159f) angle += 6.28318f;
    
    return lookup_sin(angle);
}

float lookup_cos_any(float angle)
{
    // 将角度规范化到[-π, π]范围
    while (angle > 3.14159f) angle -= 6.28318f;
    while (angle < -3.14159f) angle += 6.28318f;
    
    return lookup_cos(angle);
}